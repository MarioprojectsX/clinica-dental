---
import LangSwitcher from "./LangSwitcher.astro";

const { locale, currentPath } = Astro.props;

const nav = {
  es: [
    ["/", "Inicio"],    
    ["/es/nosotros", "Nosotros"],  
    ["/es/tratamientos", "Tratamientos"],
    ["/es/blog", "Blog"],
    ["/es", "Cita"],           
  ],
  ca: [
    ["/ca", "Inici"],    
     ["/ca/nosotros", "Nosaltres"],     
    ["/ca/tratamientos", "Tractaments"],
    ["/ca/blog", "Blog"],  
    ["/ca", "Cita"],   
  ],
  en: [
    ["/en", "Home"],           
    ["/en/nosotros", "About us"],  
    ["/en/tratamientos", "Treatments"],
    ["/en/blog", "Blog"],    
    ["/en", "Cita"],   
  ],
}[locale];

// Textos din√°micos
const texts = {
  es: {
    address: "C. de Muntaner 555, Sarri√†-Sant Gervasi, Barcelona",
    phoneLabel: "Tel√©fono",
    phoneAbbr: "Tel.",
    bookCta: "PEDIR CITA",
    bookCtaMobile:"CITAS",
    bookDrawerCtaMobile: "Pedir Cita",
    ariaLang: "Idioma",
  },
  ca: {
    address: "C. de Muntaner 555, Sarri√†-Sant Gervasi, Barcelona",
    phoneLabel: "Tel√®fon",
    phoneAbbr: "Tel.",
    bookCta: "DEMANA CITA",
    bookCtaMobile:"CITES",
    bookDrawerCtaMobile: "Demana cita",
    ariaLang: "Idioma",
  },
  en: {
    address: "C. de Muntaner 555, Sarri√†-Sant Gervasi, Barcelona",
    phoneLabel: "Phone",
    phoneAbbr: "Tel.",
    bookCta: "BOOK NOW",
    bookCtaMobile:"BOOK",
    bookDrawerCtaMobile: "Book now",
    ariaLang: "Language",
  },
}[locale];

// Submen√∫ de tratamientos (acorde√≥n m√≥vil)
const treatments = {
  es: [
    ["/es/tratamientos/ortodoncia", "Ortodoncia y alineadores"],
    ["/es/tratamientos/implantes", "Implantes dentales"],
    ["/es/tratamientos/estetica-dental", "Est√©tica dental"],
    ["/es/tratamientos/rehabilitacion-oral", "Rehabilitaci√≥n oral"],
    ["/es/tratamientos/endodoncia", "Endodoncia"],
    ["/es/tratamientos/odontopediatria", "Odontopediatr√≠a"],
  ],
  ca: [
    ["/ca/tratamientos/ortodoncia", "Ortod√≤ncia i alineadors"],
    ["/ca/tratamientos/implantes", "Implants dentals"],
    ["/ca/tratamientos/estetica-dental", "Est√®tica dental"],
    ["/ca/tratamientos/rehabilitacion-oral", "Rehabilitaci√≥ oral"],
    ["/ca/tratamientos/endodoncia", "Endod√≤ncia"],
    ["/ca/tratamientos/odontopediatria", "Odontopediatria"],
  ],
  en: [
    ["/en/tratamientos/ortodoncia", "Orthodontics & aligners"],
    ["/en/tratamientos/implantes", "Dental implants"],
    ["/en/tratamientos/estetica-dental", "Cosmetic dentistry"],
    ["/en/tratamientos/rehabilitacion-oral", "Oral rehabilitation"],
    ["/en/tratamientos/endodoncia", "Endodontics"],
    ["/en/tratamientos/odontopediatria", "Pediatric dentistry"],
  ],
}[locale];
---

<header class="site-header">
  <!-- TOPBAR -->
  <div class="topbar">
    <div class="container topbar__inner">
      <div class="contact">
        <span class="addr">{texts.address}</span>
        <span class="sep">|</span>
        <span class="tel">
          <span class="tel-label">{texts.phoneLabel}:</span>
          <span class="tel-short" aria-hidden="true">{texts.phoneAbbr}</span>
          <span class="telnum">
            <a class="tel-link" href="tel:+34603239015">+34 603 23 90 15</a>
          </span>
        </span>
      </div>

      <nav class="langs" aria-label={texts.ariaLang}>
        <LangSwitcher {currentPath} {locale} />
      </nav>
    </div>
  </div>

  <!-- MAINBAR -->
  <div class="mainbar">
    <div class="container mainbar__inner">
      <!-- CTA m√≥vil a la izquierda -->
      <a class="cta cta--mobile" href={`${nav[4][0]}/cita`}>{texts.bookCtaMobile}</a>

      <!-- Logo -->
      <a href={nav[0][0]} class="logo" aria-label="Dental Sueca">
        <picture>
          <source srcset="/assets/logo-mark.svg" media="(max-width: 640px)" />
          <img src="/assets/logo.svg" alt="Dental Sueca" />
        </picture>
      </a>

      <!-- Men√∫ principal -->
      <nav id="site-nav" class="nav" aria-label="Principal">
        <!-- üîß CAMBIO: estructura del drawer solo aplica en m√≥vil (CSS). En desktop este bloque se comporta como la nav normal. -->

       <!-- Inicio -->
      <a href={nav[0][0]}>{nav[0][1]}</a>

      <!-- Nosotros üëâ nav[2] -->
      <a href={nav[1][0]}>{nav[1][1]}</a>

      <!-- Tratamientos (link de ESCRITORIO)  üëâ nav[4] -->
      <a class="link-trat--desktop" href={nav[2][0]}>{nav[2][1]}</a>

      <!-- Acorde√≥n TRATAMIENTOS (M√ìVIL)  üëâ nav[4] -->
      <!-- <details class="nav-acc">
        <summary>
          {nav[4][1].toUpperCase()}
          <svg class="chev" viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
            <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/>
          </svg>
        </summary>
        <ul>
          {treatments.map(([href, label]) => (
            <li><a href={href}>{label}</a></li>
          ))}
        </ul>
      </details> -->

      <a href={nav[3][0]}>{nav[3][1]}</a>                      <!-- Blog (AMBOS) -->

        <!-- Botonera inferior del drawer (solo m√≥vil) -->
        <div class="drawer-actions">
          <a class="btn--cita" href={`${nav[4][0]}/cita`}>{texts.bookDrawerCtaMobile}</a>
        </div>

        <!-- üîß CAMBIO: bot√≥n de cierre dentro del drawer (m√≥vil) -->
        <button class="drawer-close" aria-label="Cerrar men√∫">
          <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
            <path d="M6 6l12 12M18 6l-12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </nav>

      <!-- Bot√≥n hamburguesa (solo m√≥vil) -->
      <button
        class="hamburger"
        aria-label="Abrir men√∫"
        aria-controls="site-nav"
        aria-expanded="false"
      >
        <svg viewBox="0 0 24 24" width="26" height="26" aria-hidden="true">
          <path d="M3 6h18M3 12h18M3 18h18"
                stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>

      <!-- CTA escritorio (oculto en m√≥vil) -->
      <a class="cta cta--desktop" href={`${nav[4][0]}/cita`}>{texts.bookCta}</a>
    </div>
  </div>

  <!-- Overlay -->
  <div class="nav-overlay" hidden></div>
</header>

<!-- Script de interacci√≥n -->
<script is:inline>
  (function () {
    const header = document.querySelector('.site-header');
    const btn = header?.querySelector('.hamburger');
    const nav = header?.querySelector('#site-nav');
    const overlay = header?.querySelector('.nav-overlay');
    const closeBtn = header?.querySelector('.drawer-close'); // üîß CAMBIO
    if (!btn || !nav || !overlay) return;

    function open() {
      header.classList.add('is-open');
      btn.setAttribute('aria-expanded', 'true');
      overlay.hidden = false;
      document.documentElement.classList.add('no-scroll-x');
    }
    function close() {
      header.classList.remove('is-open');
      btn.setAttribute('aria-expanded', 'false');
      overlay.hidden = true;
      document.documentElement.classList.remove('no-scroll-x');
    }

    btn.addEventListener('click', () => {
      header.classList.contains('is-open') ? close() : open();
    });
    overlay.addEventListener('click', close);
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') close(); });
    nav.querySelectorAll('a').forEach(a => a.addEventListener('click', close));
    closeBtn?.addEventListener('click', close); // üîß CAMBIO
  })();
</script>

<style is:global>
/* ===== Topbar (desktop base) ===== */
.topbar{
  background:#f1f2f3;
  color:var(--text-600);
  font-size:14px;
}
.topbar__inner{
  height:44px;
  display:flex; align-items:center; justify-content:space-between;
}
.contact{
  display:flex;
  align-items:baseline;
  gap:10px;
  white-space:nowrap;
  line-height:1.1;
}
.topbar .contact .telnum { text-decoration:none !important; color:inherit; cursor:default; }
.contact .sep{ color:#90a2b5; }
.contact .tel{ font-size:14px; }
.contact .telnum{ font-weight:400; color:#2d4a67; }
.topbar .tel-short{ display:none; margin-right:6px; }

/* ===== Mainbar (desktop base) ===== */
.mainbar{
  background:#fff;
  border-bottom:1px solid #eef3f8;
}
.mainbar__inner{
  height:84px;
  display:flex; align-items:center;
  gap:24px;
}
.logo{ display:inline-flex; align-items:center; text-decoration:none; margin-right:96px; }
.logo img{ height:40px; width:auto; display:block; margin-left:0px; }

.nav{
  display:flex; align-items:center;
  gap:44px;
  margin-left:auto;
  margin-right:48px;
}
.nav > a,
.nav > a:link,
.nav > a:visited{
  color:#3a3a3a;
  text-decoration:none;
  font-size:20px;
  font-weight:400;
}
.nav > a:hover{ color:var(--brand-500); }

/* CTAs */
.cta,
.cta:link,
.cta:visited{
  display:inline-block;
  background:var(--brand-500);
  color:#fff;
  text-decoration:none;
  font-weight:700;
  text-transform:uppercase;
  letter-spacing:.3px;
  font-size:18px;
  padding:9px 28px;
  border-radius:8px;
  line-height:1;
  transition:filter .15s ease-in-out, transform .06s ease-in-out;
}
.cta:active{ transform:translateY(1px); }
.cta.cta--mobile{ display:none; }
.cta--desktop{ display:inline-block; }

.hamburger{
  display:none;
  background:transparent;
  border:0;
  padding:8px;
  line-height:0;
  cursor:pointer;
  color:#1b2a3a;
}
.nav-overlay{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.28);
  z-index:998;
}
.site-header.is-open .nav-overlay{ display:block; }

/* Acorde√≥n y botones solo para m√≥vil; en escritorio oculto */
.nav-acc{ display:none; }
.drawer-actions{ display:none; }
.link-trat--desktop{ display:inline-block; }
.drawer-close{
  display: none;            
}


/* ====== M√≥vil ‚â§640px ====== */
@media (max-width: 640px){


  .mainbar__inner{
    height:56px;
    display:grid;
    grid-template-columns:auto 1fr auto;
    align-items:center;
    gap:8px;
    overflow:hidden;
  }
  .cta.cta--mobile{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    padding:8px 14px;
    font-size:14px;
    border-radius:8px;
    margin-left: 15px;
  }
  .cta--desktop{ display:none !important; }

  .logo{ margin:0; justify-self:center; }
  .logo img{ height:38px; margin:0;}
  .hamburger{ display:inline-flex; align-items:center; justify-content:center; padding:6px; margin-right: 10px;}

  /* ===== Drawer lateral (id√©ntico a maqueta) ===== */
  #site-nav{
  position: fixed;
  top: 0; right: -50px;
  height: 100dvh;
  width: 260px;
  display: flex;
  flex-direction: column;
  align-items: flex-start !important;   /* <-- clave para evitar centrado */
  gap: 6px;
  padding: 68px 12px 14px;
  background: #fff;
  border-left: 1px solid rgba(11,27,42,.06);
  transform: translateX(100%);
  box-shadow: none;
  visibility: hidden;
  transition: transform .24s ease, box-shadow .12s ease, visibility 0s linear .24s;
  z-index: 999;
  overflow-y: auto;
}
  .site-header.is-open #site-nav{
    transform: translateX(0%);
    box-shadow: -12px 0 30px rgba(0,0,0,.12);
    visibility: visible;
    transition: transform .24s ease, box-shadow .12s ease, visibility 0s;
  }

  /* Enlaces listados alineados a la izquierda (como imagen) */
  #site-nav > a{
    display:block;
    font-size:17px;                 
    line-height:1.4;                
    padding:10px 10px;              
    color:var(--text-900);
    text-decoration:none;
    border-radius:8px;
    border:1px solid transparent;
    background:transparent;
  }
  #site-nav > a + a{ margin-top:4px; }

  /* Acorde√≥n TRATAMIENTOS */
  .nav-acc{ display:block; }

  .nav-acc summary{
    list-style:none;
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:space-between;
    font-size:14px;                 /* üîß CAMBIO */
    padding:10px 10px;              /* üîß CAMBIO */
    margin:6px 0 2px;
    border-radius:8px;
    color:#0b1b2a;
    background:transparent;
  }
  .nav-acc summary::-webkit-details-marker{ display:none; }
  .nav-acc .chev{ transition: transform .18s ease; flex:0 0 auto; }
  .nav-acc[open] .chev{ transform: rotate(180deg); }

  .nav-acc ul{ margin:4px 0 8px 0; padding:0 0 0 6px; list-style:none; }
  .nav-acc li + li{ margin-top:6px; }
  .nav-acc a{
    display:block;
    font-size:14px;
    font-weight:400;
    color:#0b1b2a;
    text-decoration:none;
    padding:8px 10px;
    border-radius:8px;
  }
  .nav-acc a:hover,
  .nav-acc a:focus-visible{
    background: var(--brand-50, #e9f9ff);
    outline:none;
  }

  /* Botonera inferior */
  .drawer-actions{
    display:grid;
    padding:6px 4px 10px;
    justify-items: start;
  }
  .btn--cita{
    display:flex;
    align-items:center;
    height:30px;                    /* üîß CAMBIO */
    padding:0 12px;
    font-size:17px;
    text-decoration:none;
    background:#fff;
    color:var(--brand-900);
    border:1px solid rgba(11,27,42,.18);
    margin-top: 20px;
  }
  .chev{
    margin-left: 36px;
  }
  /* Bot√≥n X de cierre */
  .drawer-close{                   /* üîß CAMBIO */
    position:absolute;
    top:10px; right:10px;
    width:32px; height:32px;
    border:1px solid rgba(11,27,42,.18);
    border-radius:8px;
    background:#fff;
    display:inline-flex; align-items:center; justify-content:center;
    padding:0;
    color:#0b1b2a;
  }
  .topbar .addr,
  .topbar .sep,
  .topbar .tel-label{
    display: none !important;     /* ocultamos direcci√≥n, separador y "Tel√©fono:" */
  }

  .topbar__inner{ height:42px; display:flex; flex-direction:row; align-items:center; justify-content:flex-start; gap:12px; padding:6px 12px; flex-wrap:nowrap; } .topbar .contact{ order:0; margin-right:0; display:inline-flex; align-items:center; gap:8px; white-space:nowrap; line-height:1; transform:translateY(1px); } .topbar .langs{ order:10; margin-left:auto; transform:translateY(0); } .topbar .langs a{ font-size:12px; line-height:1; } .topbar .tel-short{ display:inline-block !important; color:var(--text-900, #0b1b2a); margin-right:-2px; } .topbar .telnum{ display:inline-flex; align-items:baseline; gap:6px; font-size:14px; color:var(--text-900, #0b1b2a); line-height:1; } .topbar .telnum::before{ content:none !important; }
  /* Enlaces del tel√©fono tocables */
}


.topbar .tel-link{ text-decoration:none; color:var(--text-900); }
.topbar .tel-link:hover{ text-decoration:none; }
</style>
